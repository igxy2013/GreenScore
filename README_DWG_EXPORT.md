# 绿色建筑设计专篇DWG导出功能

## 功能概述

本功能允许用户将项目的评分数据和项目信息同步输出到DWG文件中的属性块中。用户可以通过点击"绿色建筑设计专篇"菜单项来触发此功能，系统会根据项目的评价标准和星级目标选择相应的DWG模板文件，并将项目信息和评分数据填充到DWG文件的属性块中。

## 实现细节

### 1. 前端实现

在 `templates/index.html`文件中，我们添加了 `generateDWG`函数，该函数会在用户点击"绿色建筑设计专篇"菜单项时触发。该函数会向后端发送请求，获取生成的DWG文件，并提供下载链接。

### 2. 后端实现

在 `export.py`文件中，我们实现了 `generate_dwg`函数，该函数会根据项目ID获取项目信息和评分数据，然后根据项目的评价标准和星级目标选择相应的DWG模板文件，并将项目信息和评分数据填充到DWG文件的属性块中。

### 3. DWG文件更新

在 `update_dwg_attribute.py`文件中，我们实现了 `update_attribute_text`函数，该函数会使用COM接口连接AutoCAD应用程序，打开DWG文件，更新属性块中的文本内容，然后保存为新的DWG文件。

## 使用方法

1. 在系统中选择一个项目
2. 点击左侧菜单中的"绿色建筑设计专篇"菜单项
3. 系统会自动生成DWG文件，并提供下载链接
4. 下载的DWG文件可以使用AutoCAD打开，查看和编辑

## 属性块标签

DWG文件中的属性块标签包括：

### 项目信息

- 项目名称
- 设计单位
- 建设单位
- 建筑面积
- 建筑类型
- 项目地点
- 气候区划
- 星级目标
- 总用地面积
- 绿地面积
- 绿地率
- 容积率
- 建筑密度
- 建筑层数
- 建筑高度
- 地上建筑面积
- 地下建筑面积

### 评分数据

- 建筑总分
- 结构总分
- 给排水总分
- 电气总分
- 暖通总分
- 景观总分
- 建筑创新总分
- 结构创新总分
- 暖通创新总分
- 景观创新总分
- 安全耐久总分
- 健康舒适总分
- 生活便利总分
- 资源节约总分
- 环境宜居总分
- 提高与创新总分
- 项目总分
- 评定结果

### 条文得分和技术措施

- 条文号（如3.1.2.1）：对应的分值
- 条文号措施（如3.1.2.1措施）：对应的技术措施内容

## 注意事项

1. 确保系统中已安装AutoCAD，并且可以通过COM接口访问
2. 确保DWG模板文件存在于 `static/templates`目录中
3. 确保temp目录有写入权限
4. 如果技术措施内容为空，则不会在DWG文件中显示
5. 如果DWG模板文件中不存在某些属性块标签，系统会在日志中输出警告信息，但不会影响其他属性块的更新

## 测试

可以使用 `test_dwg_export.py`脚本测试DWG导出功能：

```bash
python test_dwg_export.py <项目ID>
```

该脚本会生成一个测试用的DWG文件，并将属性数据保存到JSON文件中，以便检查。

## 模板文件

系统支持以下模板文件：

- 绿色建筑设计专篇(市标2024).dwg
- 绿色建筑设计专篇(省标2024).dwg
- 绿色建筑设计专篇(省标基本级2024).dwg
- 绿色建筑设计专篇(国标2024).dwg
- 绿色建筑设计专篇(国标基本级2024).dwg

系统会根据项目的评价标准和星级目标选择相应的模板文件。
