<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>绿色建材比例计算</title>
    
    <!-- 内联 Remix Icon CSS -->
    <style>
    /*
    * Remix Icon v4.5.0 (Simplified)
    */
    [class^="ri-"], [class*=" ri-"] {
      display: inline-block;
      width: 1em;
      height: 1em;
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center;
      vertical-align: middle;
    }
    
    /* User icon */
    .ri-user-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M4 22a8 8 0 1 1 16 0h-2a6 6 0 1 0-12 0H4zm8-9c-3.315 0-6-2.685-6-6s2.685-6 6-6 6 2.685 6 6-2.685 6-6 6zm0-2c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z'/%3E%3C/svg%3E");
    }
    
    /* Lock icon */
    .ri-lock-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M19 10h1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V11a1 1 0 0 1 1-1h1V9a7 7 0 1 1 14 0v1zm-2 0V9A5 5 0 0 0 7 9v1h10zm-6 4v4h2v-4h-2z'/%3E%3C/svg%3E");
    }
    
    /* Eye icons */
    .ri-eye-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M12 3c5.392 0 9.878 3.88 10.819 9-.94 5.12-5.427 9-10.819 9-5.392 0-9.878-3.88-10.819-9C2.121 6.88 6.608 3 12 3zm0 16a9.005 9.005 0 0 0 8.777-7 9.005 9.005 0 0 0-17.554 0A9.005 9.005 0 0 0 12 19zm0-2.5a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9zm0-2a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z'/%3E%3C/svg%3E");
    }
    
    .ri-eye-off-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M17.882 19.297A10.949 10.949 0 0 1 12 21c-5.392 0-9.878-3.88-10.819-9a10.982 10.982 0 0 1 3.34-6.066L1.392 2.808l1.415-1.415 19.799 19.8-1.415 1.414-3.31-3.31zM5.935 7.35A8.965 8.965 0 0 0 3.223 12a9.005 9.005 0 0 0 13.201 5.838l-2.028-2.028A4.5 4.5 0 0 1 8.19 9.604L5.935 7.35zm6.979 6.978l-3.242-3.242a2.5 2.5 0 0 0 3.241 3.241zm7.893 2.264l-1.431-1.43A8.935 8.935 0 0 0 20.777 12 9.005 9.005 0 0 0 9.552 5.338L7.974 3.76C9.221 3.27 10.58 3 12 3c5.392 0 9.878 3.88 10.819 9a10.947 10.947 0 0 1-2.012 4.592zm-9.084-9.084a4.5 4.5 0 0 1 4.769 4.769l-4.77-4.769z'/%3E%3C/svg%3E");
    }
    
    /* Check icons */
    .ri-checkbox-circle-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-.997-4L6.76 11.757l1.414-1.414 2.829 2.829 5.656-5.657 1.415 1.414L11.003 16z'/%3E%3C/svg%3E");
    }
    
    .ri-check-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z'/%3E%3C/svg%3E");
    }
    
    /* Warning icons */
    .ri-error-warning-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-1-5h2v2h-2v-2zm0-8h2v6h-2V7z'/%3E%3C/svg%3E");
    }
    
    .ri-close-circle-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z'/%3E%3C/svg%3E");
    }
    
    /* Loader icon */
    .ri-loader-4-line {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M18.364 5.636L16.95 7.05A7 7 0 1 0 19 12h2a9 9 0 1 1-2.636-6.364z'/%3E%3C/svg%3E");
    }
    </style>
    
    <!-- 使用 Tailwind CDN 作为主要样式源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 本地 CSS 文件作为备份 -->
    <link href="/static/tailwind.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- 延迟加载非关键JS -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>
    <script src="/static/js/exportWord.js" defer></script>
    
    <script>
    tailwind.config={theme:{extend:{colors:{primary:'#3176FF',secondary:'#6B7280'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}
    </script>
    <style>
    :root {
        --color-primary: #3176FF;
        --color-secondary: #6B7280;
    }
    .checkbox-wrapper input[type="checkbox"] {
        opacity: 0;
        position: absolute;
    }
    .checkbox-wrapper .custom-checkbox {
        width: 18px;
        height: 18px;
        border: 2px solid #e5e7eb;
        border-radius: 4px;
        display: inline-block;
        position: relative;
        cursor: pointer;
        transition: all 0.2s;
    }
    .checkbox-wrapper input[type="checkbox"]:checked + .custom-checkbox {
        background-color: #3176FF;
        border-color: #3176FF;
    }
    .checkbox-wrapper input[type="checkbox"]:checked + .custom-checkbox::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 2px;
        width: 5px;
        height: 9px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    .category {
        transition: all 0.3s ease;
    }
    .category:hover {
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    .sub-item {
        display: flex;
        align-items: center;
        margin: 8px 0;
        font-size: 14px;
    }
    .checkbox-wrapper {
        display: flex;
        align-items: center;
        margin-right: 8px;
    }
    /* 修复复选框样式 */
    .checkbox-wrapper input[type="checkbox"] {
        opacity: 0;
        position: absolute;
        cursor: pointer;
    }
    .checkbox-wrapper .custom-checkbox {
        width: 18px;
        height: 18px;
        border: 2px solid #e5e7eb;
        border-radius: 4px;
        display: inline-block;
        position: relative;
        cursor: pointer;
        transition: all 0.2s;
        margin-right: 8px;
    }
    .checkbox-wrapper input[type="checkbox"]:checked + .custom-checkbox {
        background-color: #3176FF;
        border-color: #3176FF;
    }
    .checkbox-wrapper input[type="checkbox"]:checked + .custom-checkbox::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 2px;
        width: 5px;
        height: 9px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    .note-italic {
        font-style: italic;
        font-size: 14px;
        color: #6B7280;
    }
    /* 隐藏页面内部滚动条，解决双滚动条问题 */
    body {
        overflow: visible !important; /* 强制显示所有内容不使用滚动条 */
    }
    html {
        overflow: visible !important;
    }

    .bg {
        background-color: #3176FF; 
    }

    </style>


</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-white py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-[50%] mx-auto">
        <h2 class="text-4xl font-semibold text-primary text-center mb-12">绿色建材应用比例计算</h2>
        
        <div class="bg-white rounded-lg shadow-xl p-8 mb-8">
            <div class="flex gap-6 mb-8">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-2">子项名称</label>
                    <input type="text" id="buildingNo" placeholder="子项名称" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>

                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-2">评价依据</label>
                    <select id="standardSelection" class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="municipal">成都市标</option>
                        <option value="provincial">四川省标</option>
                        <option value="national">通用国标</option>
                    </select>
                </div>
            </div>

        <div id="indicators" class="space-y-6">
            <div class="category bg-white rounded-lg shadow-lg overflow-hidden" data-category="Q1">
                <h3 class="bg text-white px-6 py-4 flex justify-between items-center cursor-pointer">
                    主体及围护结构工程用材 Q1（45分）
                    <span class="toggle">▼</span>
                </h3>
                <div class="sub-items p-6">
                    <div class="sub-item font-bold">
                        <span class="inline-block w-48">二级指标</span>
                        <span class="inline-block w-36">应用比例要求</span>
                        <span class="inline-block w-36">绿材应用比例</span>
                    </div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">预拌混凝土</span> <span class="inline-block w-36">≥80%</span> <input type="number" value="100" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">预拌砂浆</span> <span class="inline-block w-36">≥80%</span> <input type="number" value="100" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">砌体材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">石材</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">防水密封材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">保温隔热材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">混凝土构件</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">钢结构构件</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">木结构构件</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">轻钢龙骨</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">节能门窗</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">遮阳制品</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">建筑幕墙</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">墙板</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">其他类</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <p class="note-italic">注：二级指标中选中项为本项目实际使用项目,包括绿色建材和非绿色建材。</p>
                </div>
            </div>
            <div class="category bg-white rounded-lg shadow-lg overflow-hidden" data-category="Q2">
                <h3 class="bg text-white px-6 py-4 flex justify-between items-center cursor-pointer">
                    装饰装修工程用材 Q2（35分）
                    <span class="toggle">▼</span>
                </h3>
                <div class="sub-items p-6">
                    <div class="sub-item font-bold">
                        <span class="inline-block w-48">二级指标</span>
                        <span class="inline-block w-36">应用比例要求</span>
                        <span class="inline-block w-36">绿材应用比例</span>
                    </div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">吊顶及配件</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">墙面涂料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">装配式集成墙面</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">壁纸（布）</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">建筑装饰板</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">装修用木制品</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">石膏装饰材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">抗菌净化材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">建筑陶瓷制品</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">地坪材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">卫生洁具</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">其他类</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <p class="note-italic">注：二级指标中选中项为本项目实际使用项目,包括绿色建材和非绿色建材。</p>
                </div>
            </div>
            <div class="category bg-white rounded-lg shadow-lg overflow-hidden" data-category="Q3">
                <h3 class="bg text-white px-6 py-4 flex justify-between items-center cursor-pointer">
                    机电安装工程用材 Q3（15分）
                    <span class="toggle">▼</span>
                </h3>
                <div class="sub-items p-6">
                    <div class="sub-item font-bold">
                        <span class="inline-block w-48">二级指标</span>
                        <span class="inline-block w-36">应用比例要求</span>
                        <span class="inline-block w-36">绿材应用比例</span>
                    </div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">管材管件</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">LED 照明产品</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">电线电缆</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">新风净化设备及其系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">采暖空调设备及其系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">热泵产品及其系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">辐射供暖供冷设备及其系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">一体化生活污水处理设备</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">太阳能光伏发电系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">其他类</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <p class="note-italic">注：二级指标中选中项为本项目实际使用项目,包括绿色建材和非绿色建材。</p>
                </div>
            </div>
            <div class="category bg-white rounded-lg shadow-lg overflow-hidden" data-category="Q4">
                <h3 class="bg text-white px-6 py-4 flex justify-between items-center cursor-pointer">
                    室外工程用材 Q4（5分）
                    <span class="toggle">▼</span>
                </h3>
                <div class="sub-items p-6">
                    <div class="sub-item font-bold">
                        <span class="inline-block w-48">二级指标</span>
                        <span class="inline-block w-36">应用比例要求</span>
                        <span class="inline-block w-36">绿材应用比例</span>
                    </div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">雨水收集回用系统</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">透水铺装材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">屋顶绿化材料</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox"><span class="custom-checkbox"></span><span class="inline-block w-48">机械式停车设备</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <div class="sub-item checkbox-wrapper"><input type="checkbox" checked="true"><span class="custom-checkbox"></span><span class="inline-block w-48">其他类</span> <span class="inline-block w-36">≥80%</span> <input type="number" min="0" max="100" placeholder="实际比例" class="w-24 px-2 py-1 border border-gray-300 rounded-button text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">%</div>
                    <p class="note-italic">注：二级指标中选中项为本项目实际使用项目,包括绿色建材和非绿色建材。</p>
                </div>
            </div>
        </div>
        <div class="flex space-x-4 mt-8">
            <button onclick="calculate()" class="px-6 py-3 bg-primary text-white rounded-button hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                立即计算
            </button>
            <button onclick="exportWord()" class="px-6 py-3 bg-primary text-white rounded-button hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                导出计算书
            </button>
            <button onclick="saveForm()" class="px-6 py-3 bg-white text-primary border border-primary rounded-button hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                保存数据
            </button>
        </div>

        <div id="result" class="mt-8 bg-white rounded-lg shadow-xl p-8 hidden">
            <!-- 结果内容将通过 JavaScript 动态填充 -->
        </div>
    </div>
    
    <script>
        // 全局存储计算结果
        const reportData = {
            projectName: '',
            buildingNo: '',
            categories: {
                Q1: { score: 0, label: '主体及围护结构工程用材', total: 45 },
                Q2: { score: 0, label: '装饰装修工程用材', total: 35 },
                Q3: { score: 0, label: '机电安装工程用材', total: 15 },
                Q4: { score: 0, label: '室外工程用材', total: 5 }
            },
            totalScore: 0,
            result: 0,
            Original: ''
        };
        
        // 优化后的用户信息加载
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟加载表单数据
            setTimeout(loadForm, 300);
            
            // 初始化折叠功能
            initializeCollapsibleSections();
            
            // 初始化复选框事件
            initializeCheckboxes();
        });
        
        // 折叠功能
        function initializeCollapsibleSections() {
            document.querySelectorAll('.toggle, .category h3').forEach((toggle, index) => {
                toggle.style.cursor = 'pointer';
                const content = toggle.parentElement.querySelector('.sub-items');
                
                // 默认折叠除了第一个类别
                if (index !== 0 && content) {
                    content.style.display = 'none';
                }

                toggle.addEventListener('click', () => {
                    if (content) {
                        content.style.display = content.style.display === 'none' ? 'block' : 'none';
                        const toggleIcon = toggle.parentElement.querySelector('.toggle');
                        if (toggleIcon) {
                            toggleIcon.innerHTML = content.style.display === 'none' ? 
                                '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M6 0L16 8L6 16V0Z"/></svg>' : 
                                '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6L16 6L8 16L0 6Z"/></svg>';
                        }
                    }
                });
            });
        }
        
        // 初始化复选框事件
        function initializeCheckboxes() {
            document.querySelectorAll('.checkbox-wrapper input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const customCheckbox = this.nextElementSibling;
                    if (this.checked) {
                        customCheckbox.classList.add('checked');
                    } else {
                        customCheckbox.classList.remove('checked');
                    }
                });
            });

            document.querySelectorAll('.checkbox-wrapper .custom-checkbox').forEach(customCheckbox => {
                customCheckbox.addEventListener('click', function() {
                    const checkbox = this.previousElementSibling;
                    checkbox.click();
                });
            });
        }
        
        function calculate() {
            try {
                // 重置数据
                reportData.buildingNo = document.getElementById('buildingNo').value || '';
                reportData.standard = document.getElementById('standardSelection').value || '成都市标';
                Object.values(reportData.categories).forEach(cat => {
                    cat.score = 0;
                    cat.items = []; // 确保 items 数组被重置
                });
                reportData.totalScore = 0;
                reportData.result = 0;
                reportData.Original = '';

                // 遍历每个分类区块
                document.querySelectorAll('.category').forEach(categoryDiv => {
                    const categoryKey = categoryDiv.getAttribute('data-category');
                    const category = reportData.categories[categoryKey];

                    if (!category) {
                        console.error(`未找到分类: ${categoryKey}`);
                        return;
                    }
                    // 遍历子项，跳过第一项（标题行）
                    let checkedCount = 0;
                    let qualifiedCount = 0;
                    let isFirstItem = true;
                    categoryDiv.querySelectorAll('.sub-item').forEach(itemDiv => {
                        // 跳过第一项（标题行）
                        if (isFirstItem) {
                            isFirstItem = false;
                            return;
                        }

                        const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                        const input = itemDiv.querySelector('input[type="number"]');
                        const actualValue = parseFloat(input.value) || 0;

                        category.items.push({
                            name: itemDiv.textContent.split('≥')[0].trim(),
                            checked: checkbox.checked,
                            actual: actualValue
                        });

                        if (checkbox.checked) {
                            checkedCount++;
                            if (actualValue >= 80) qualifiedCount++;
                        }
                    });

                    // 计算分类得分（核心公式）
                    const categoryTotal = category.total;
                    const categoryScore = checkedCount > 0 
                        ? (qualifiedCount / checkedCount) * categoryTotal
                        : 0;
                    category.score = categoryScore;
                    reportData.totalScore += categoryScore; // 累加总得分
                });

                // 计算绿建得分
                reportData.result = calculateGreenScore(reportData.totalScore);
                //结论
                if (reportData.totalScore > 10 && reportData.result == 0)
                {
                  reportData.Original = "本项目绿色建材应用比例为" + reportData.totalScore.toFixed(1) + "%，满足《绿色建筑评价标准》GB/T 50378-2019（2024版）第3.2.8条要求。"
                }
                else if(reportData.result>0)
                {
                  reportData.Original = "本项目绿色建材应用比例为" + reportData.totalScore.toFixed(1) + "%，满足《绿色建筑评价标准》GB/T 50378-2019（2024版）第3.2.8条要求，且满足第7.2.18条要求，可得" + reportData.result + "分。"
                }
                // 显示结果
                showResult(reportData);
                // 添加200ms延时，确保滚动到底部
                setTimeout(() => {
                    window.scrollTo(0, document.body.scrollHeight);
                }, 200);
            } catch (error) {
                alert('计算错误：' + error.message);
                console.error('计算错误详情:', error);
            }
        }

        function calculateGreenScore(total) {
            if (total >= 70) return 12;
            if (total >= 60) return 8;
            if (total >= 40) return 4;
            return 0;
        }
        function calculateGreenStar(total) {
            if (total >= 30) return '满足三星级要求';
            if (total >= 20) return '满足二星级要求';
            if (total >= 10) return '满足一星级要求';
            return '不满足星级要求';
        }
        // 更新后的结果显示函数
        function showResult(data) {
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('hidden');
            const GreenStar = calculateGreenStar(data.totalScore);
            
            resultDiv.innerHTML = `
                <h3 class="text-2xl font-semibold text-primary mb-6">绿色建材得分统计</h3>
                <div class="space-y-4 mb-6">
                    <p class="text-gray-700">子项名称：${data.buildingNo || '未填写'}</p>
                    <p class="text-gray-700">评价标准：${data.standard || '成都市标'}</p>
                </div>
                <hr class="my-6">
                <div class="space-y-4">
                    ${Object.entries(data.categories).map(([key, category]) => `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="font-medium text-gray-900">${category.label}</div>
                            <div class="mt-2 text-gray-600">
                                得分 ${category.score.toFixed(1)} / 总分 ${category.total}
                                <span class="text-primary">(达标率 ${(category.score / category.total * 100).toFixed(1)}%)</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 class="text-xl font-medium text-primary">
                        总得分：${data.totalScore.toFixed(1)} 分（满分100分）
                    </h4>
                </div>
                <div class="mt-6 p-4 bg-green-50 rounded-lg">
                    <h3 class="text-lg font-medium text-green-800">
                        绿色建材应用比例：${(data.totalScore / 100 * 100).toFixed(1)}%
                        <br>
                        ${GreenStar}，绿建评分项可得分：${data.result}分
                    </h3>
                </div>
            `;
        }

        // 添加保存表单数据的函数
        async function saveForm() {
            try {
                // 显示保存中的提示
                const saveBtn = document.querySelector('button[onclick="saveForm()"]');
                const originalText = saveBtn.textContent;
                saveBtn.textContent = '保存中...';
                saveBtn.disabled = true;
                
                // 收集所有表单数据
                const formData = {
                    buildingNo: document.getElementById('buildingNo').value || '',
                    standardSelection: document.getElementById('standardSelection').value || 'municipal',
                    formData: {}
                };

                // 收集所有分类的数据
                document.querySelectorAll('.category').forEach(category => {
                    const categoryKey = category.getAttribute('data-category');
                    formData.formData[categoryKey] = [];
                    
                    // 跳过第一个子项（标题行）
                    let isFirstItem = true;
                    category.querySelectorAll('.sub-item').forEach(item => {
                        if (isFirstItem) {
                            isFirstItem = false;
                            return;
                        }
                        
                        const checkbox = item.querySelector('input[type="checkbox"]');
                        const input = item.querySelector('input[type="number"]');
                        
                        if (checkbox && input) {
                            formData.formData[categoryKey].push({
                                checked: checkbox.checked,
                                value: input.value || "0"
                            });
                        }
                    });
                });

                // 确保 JSON 数据不超过数据库字段长度限制
                const jsonString = JSON.stringify(formData.formData);
                if (jsonString.length > 4000) {
                    throw new Error('表单数据过大，请减少输入数据量');
                }

                const response = await fetch('/api/save_form', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // 恢复按钮状态
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;

                if (response.ok) {
                    // 显示成功消息
                    alert('数据保存成功！');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '保存失败');
                }
            } catch (error) {
                console.error('保存数据失败:', error);
                alert('保存失败: ' + error.message);
                
                // 确保按钮恢复正常状态
                const saveBtn = document.querySelector('button[onclick="saveForm()"]');
                if (saveBtn.disabled) {
                    saveBtn.textContent = '保存数据';
                    saveBtn.disabled = false;
                }
            }
        }

        // 添加加载表单数据的函数
        async function loadForm() {
            try {
                const response = await fetch('/api/load_form');
                if (response.ok) {
                    const data = await response.json();
                    
                    // 填充基本信息
                    document.getElementById('buildingNo').value = data.buildingNo || '';
                    if (document.getElementById('standardSelection')) {
                        document.getElementById('standardSelection').value = data.standardSelection || 'municipal';
                    }
                    
                    // 填充表单数据
                    if (data.formData) {
                        Object.entries(data.formData).forEach(([categoryKey, items]) => {
                            const category = document.querySelector(`.category[data-category="${categoryKey}"]`);
                            if (!category) return;
                            
                            // 跳过第一个子项（标题行）
                            let subItems = Array.from(category.querySelectorAll('.sub-item'));
                            subItems = subItems.slice(1); // 跳过标题行
                            
                            items.forEach((item, index) => {
                                if (index >= subItems.length) return;
                                
                                const subItem = subItems[index];
                                const checkbox = subItem.querySelector('input[type="checkbox"]');
                                const input = subItem.querySelector('input[type="number"]');
                                
                                if (checkbox && input) {
                                    checkbox.checked = item.checked;
                                    input.value = item.value || "0";
                                    
                                    // 触发checkbox的change事件以更新样式
                                    const event = new Event('change');
                                    checkbox.dispatchEvent(event);
                                }
                            });
                        });
                    }
                    console.log('表单数据加载成功');
                } else if (response.status !== 404) {
                    // 404 表示没有保存的数据，这是正常的
                    console.warn('加载表单数据失败:', response.statusText);
                }
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }

        // 导出到Word功能
        function exportToWordSimple() {
            var exportContent = document.querySelector('#export-content');
            if (!exportContent) return;
            
            var html = exportContent.innerHTML;
            var blob = new Blob(['<html><head><meta charset="utf-8"><title>绿色建材应用比例计算</title><style>body{font-family:SimSun, serif;font-size:12pt;line-height:1.5;}table{border-collapse:collapse;width:100%;}th,td{border:1px solid black;padding:8px;text-align:left;}th{background-color:#f2f2f2;}h1,h2,h3{text-align:center;}</style></head><body>' + html + '</body></html>'], {type: 'application/msword'});
            saveAs(blob, '绿色建材应用比例计算.doc');
        }
    </script>
    <!-- 页面主要JS -->
    <script src="/static/calculator.js" defer></script>
    <script src="/static/js/exportWord.js"></script>
</body>
</html>