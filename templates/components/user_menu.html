<!-- 用户菜单组件 -->
<!-- 用户图标 -->
<div class="user-icon" id="userIcon">
    <i class="fas fa-user-circle text-primary text-xl"></i>
</div>

<!-- 用户菜单，默认隐藏 -->
<div class="user-menu" id="userMenu">
    <!-- 用户信息 -->
    <div class="flex items-center px-4 py-3 border-b border-gray-100">
        <i class="fas fa-user-circle text-primary text-xl"></i>
        <span class="ml-2 text-gray-700 font-medium">
            {{ session.get('username', '未登录').split('@')[0] }}
        </span>
    </div>
    
    <!-- 系统设置选项 -->
    <div class="flex items-center px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer hidden">
        <i class="fas fa-cog text-gray-500"></i>
        <span class="ml-2 text-gray-700">系统设置</span>
    </div>
    
    <!-- 用户指南选项 -->
    <a href="{{ url_for('user_guide') }}" class="flex items-center px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
        <i class="fas fa-book text-gray-500"></i>
        <span class="ml-2 text-gray-700">用户使用指南</span>
    </a>
    
    <!-- 联系我们选项 -->
    <div id="contactUsBtn" class="flex items-center px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer">
        <i class="fas fa-paper-plane text-gray-500"></i>
        <span class="ml-2 text-gray-700">联系我们</span>
    </div>
    
    <!-- 退出登录选项 -->
    <a href="{{ url_for('logout') }}" class="flex items-center px-4 py-3 hover:bg-gray-50 cursor-pointer group">
        <i class="fas fa-sign-out-alt text-gray-500 group-hover:text-red-500"></i>
        <span class="ml-2 text-gray-700 group-hover:text-red-500">退出登录</span>
    </a>
</div>

<!-- 用户菜单相关样式 -->
<style>
/* 用户菜单样式 */
.user-icon {
    position: fixed;
    left: 20px;
    bottom: 20px;
    z-index: 60;
    width: 42px;
    height: 42px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.user-icon:hover {
    transform: scale(1.05);
}

.user-menu {
    position: fixed;
    left: 20px;
    bottom: 72px;
    z-index: 50;
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 170px;
    transition: all 0.3s ease;
    transform-origin: bottom left;
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
}

.user-menu.active {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
}

/* 联系我们模态框样式 */
.contact-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.contact-modal-content {
    background-color: white;
    border-radius: 0.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 500px;
    padding: 1.5rem;
}
</style>

<!-- 用户菜单相关脚本 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 用户菜单相关的JavaScript
    const userIcon = document.getElementById('userIcon');
    const userMenu = document.getElementById('userMenu');
    const contactUsBtn = document.getElementById('contactUsBtn');
    
    let contactModal = null;
    
    // 创建联系我们模态框
    function createContactModal() {
        // 创建模态框背景
        contactModal = document.createElement('div');
        contactModal.className = 'contact-modal';
        
        // 创建模态框内容
        const modalContent = document.createElement('div');
        modalContent.className = 'contact-modal-content';
        modalContent.onclick = function(e) {
            e.stopPropagation();
        };
        
        // 创建标题和关闭按钮
        const header = document.createElement('div');
        header.className = 'flex justify-between items-center mb-4';
        
        const title = document.createElement('h3');
        title.className = 'text-xl font-bold';
        title.textContent = '联系我们';
        
        const closeBtn = document.createElement('button');
        closeBtn.className = 'text-gray-500 hover:text-gray-700';
        closeBtn.title = '关闭';
        closeBtn.innerHTML = '<i class="fas fa-times"></i>';
        closeBtn.onclick = closeContactModal;
        
        header.appendChild(title);
        header.appendChild(closeBtn);
        
        // 创建内容
        const content = document.createElement('div');
        content.className = 'space-y-4';
        
        // 邮箱信息
        const emailInfo = document.createElement('div');
        emailInfo.className = 'flex items-center space-x-3';
        emailInfo.innerHTML = `
            <i class="fas fa-envelope text-primary text-xl"></i>
            <div>
                <p class="text-gray-700 font-medium">Email：</p>
                <p class="text-gray-600">acbim@qq.com</p>
            </div>
        `;
        
        // QQ群信息
        const qqInfo = document.createElement('div');
        qqInfo.className = 'flex items-center space-x-3';
        qqInfo.innerHTML = `
            <i class="fab fa-qq text-primary text-xl"></i>
            <div>
                <p class="text-gray-700 font-medium">用户服务QQ群：</p>
                <p class="text-gray-600">715172744</p>
            </div>
        `;
        
        content.appendChild(emailInfo);
        content.appendChild(qqInfo);
        
        // 创建底部按钮
        const footer = document.createElement('div');
        footer.className = 'mt-6 flex justify-end';
        
        const closeFooterBtn = document.createElement('button');
        closeFooterBtn.className = 'px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90';
        closeFooterBtn.textContent = '关闭';
        closeFooterBtn.onclick = closeContactModal;
        
        footer.appendChild(closeFooterBtn);
        
        // 组装模态框
        modalContent.appendChild(header);
        modalContent.appendChild(content);
        modalContent.appendChild(footer);
        contactModal.appendChild(modalContent);
        
        // 点击模态框背景关闭
        contactModal.onclick = closeContactModal;
        
        // 添加到body
        document.body.appendChild(contactModal);
        
        // 阻止页面滚动
        document.body.style.overflow = 'hidden';
        
        console.log('联系我们模态框已创建并打开');
        return contactModal;
    }
    
    // 显示联系我们模态框
    function showContactModal() {
        if (!contactModal) {
            contactModal = createContactModal();
        } else {
            contactModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
    }
    
    // 关闭联系我们模态框
    function closeContactModal() {
        if (contactModal) {
            contactModal.style.display = 'none';
            document.body.style.overflow = '';
            console.log('联系我们模态框已关闭');
        }
    }
    
    // 点击用户图标显示菜单
    if (userIcon) {
        userIcon.addEventListener('click', function(e) {
            e.stopPropagation();
            userMenu.classList.toggle('active');
        });
    }

    // 点击联系我们显示联系信息模态框
    if (contactUsBtn) {
        contactUsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (userMenu) userMenu.classList.remove('active');
            showContactModal();
        });
    }

    // 点击页面其他区域关闭菜单
    document.addEventListener('click', function(e) {
        if (userMenu && !userMenu.contains(e.target) && userIcon && !userIcon.contains(e.target)) {
            userMenu.classList.remove('active');
        }
    });
    
    // 将关闭函数添加到全局作用域，以便其他地方可以调用
    window.closeContactModal = closeContactModal;
});
</script> 